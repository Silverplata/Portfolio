---
import Sun from './icons/Sun.astro';
import Moon from './icons/Moon.astro';
---

<button id="theme-toggle" aria-label="Alternar tema" class="theme-toggle">
  <span class="slider"></span>
  <span class="icon sun"><Sun /></span>
  <span class="icon moon"><Moon /></span>
</button>

<script>
  const html = document.documentElement;
  const themeToggle = document.getElementById('theme-toggle');

  // Definir el tipo de theme explícitamente
  type Theme = 'light' | 'dark';

  const setTheme = (theme: Theme) => {
    html.classList.remove('light', 'dark');
    html.classList.add(theme);
    localStorage.setItem('theme', theme);
    // Actualizar el estado visual del toggle
    if (themeToggle) {
      themeToggle.setAttribute('data-theme', theme);
    }
  };

  const toggleTheme = () => {
    const currentTheme = html.classList.contains('dark') ? 'light' : 'dark';
    setTheme(currentTheme);
  };

  const initializeTheme = () => {
    const savedTheme = localStorage.getItem('theme') as Theme | null;
    const theme = savedTheme === 'dark' ? 'dark' : 'light';
    setTheme(theme);
  };

  // Verificar que el botón exista antes de añadir el event listener
  if (themeToggle instanceof HTMLElement) {
    themeToggle.addEventListener('click', toggleTheme);
  } else {
    console.error('No se encontró el botón con ID "theme-toggle"');
  }

  initializeTheme();
</script>

<style>
  .theme-toggle {
    position: relative;
    display: inline-flex;
    align-items: center;
    width: 3rem; /* 48px */
    height: 1.5rem; /* 24px */
    background-color: #d1d5db; /* Gris claro para fondo inactivo */
    border-radius: 9999px; /* Bordes completamente redondeados */
    padding: 0.2rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .theme-toggle[data-theme="dark"] {
    background-color: #4b5563; /* Gris oscuro para modo oscuro */
  }

  .slider {
    position: absolute;
    width: 1rem; /* 16px, reducido para evitar superposición */
    height: 1rem; /* 16px */
    background-color: rgba(255, 255, 255, 0.9); /* Fondo semitransparente */
    border-radius: 50%;
    transform: translateX(0);
    transition: transform 0.3s ease;
    z-index: 1; /* Asegurar que esté debajo de los íconos */
  }

  .theme-toggle[data-theme="dark"] .slider {
    transform: translateX(1.6rem); /* Ajustado para dejar espacio al ícono */
  }

  .icon {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1rem; /* 16px */
    height: 1rem;
    z-index: 2; /* Íconos por encima del slider */
    transition: opacity 0.3s ease;
  }

  .sun {
    opacity: 1;
    left: 0.3rem; /* Ajustado para centrar en el toggle */
  }

  .moon {
    opacity: 0;
    right: 0.3rem; /* Ajustado para evitar superposición */
  }

  .theme-toggle[data-theme="dark"] .sun {
    opacity: 0;
  }

  .theme-toggle[data-theme="dark"] .moon {
    opacity: 1;
  }

  .theme-toggle:hover {
    background-color: #2563eb; /* Azul para hover, alineado con nav */
  }

  svg {
    width: 1rem; /* 16px, tamaño consistente */
    height: 1rem;
    fill: currentColor; /* Hereda color del contexto */
  }

  .theme-toggle[data-theme="light"] svg {
    color: #0f172a; /* Color de los íconos en modo claro */
  }

  .theme-toggle[data-theme="dark"] svg {
    color: #e2e8f0; /* Color de los íconos en modo oscuro */
  }
</style>